<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bewerbungs Manager</title>
<style>
body{
  font-family: Arial, sans-serif;
  background:#f1f5f9;
  margin:0;
  padding:20px;
}
h1{
  text-align:center;
  color:#1e3a8a;
}
.container{
  max-width:1100px;
  margin:auto;
}
form{
  background:white;
  padding:20px;
  border-radius:10px;
  box-shadow:0 4px 10px rgba(0,0,0,0.1);
  margin-bottom:20px;
}
input, textarea, select{
  width:100%;
  padding:10px;
  margin:8px 0;
  border-radius:6px;
  border:1px solid #ccc;
}
button{
  padding:8px 12px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  color:white;
}
.add-btn{
  background:#3b82f6;
}
.add-btn:hover{
  background:#2563eb;
}
.delete-btn{
  background:#ef4444;
}
.delete-btn:hover{
  background:#dc2626;
}
.status-btn{
  border-radius:20px;
  padding:5px 12px;
  font-weight:bold;
}
.Gesendet{ background:#3b82f6; }
.Antwort{ background:#10b981; }
.Einladung{ background:#8b5cf6; }
.Absage{ background:#ef4444; }
.filters{
  display:flex;
  gap:10px;
  margin:20px 0;
}
.filters input, .filters select{
  flex:1;
  padding:8px;
  border-radius:6px;
  border:1px solid #ccc;
}
table{
  width:100%;
  border-collapse:collapse;
  background:white;
  border-radius:10px;
  overflow:hidden;
  box-shadow:0 4px 10px rgba(0,0,0,0.1);
}
th, td{
  padding:12px;
  text-align:left;
  border-bottom:1px solid #ddd;
}
th{
  background:#3b82f6;
  color:white;
}
.counter{
  margin-bottom:10px;
  font-weight:bold;
}
td[contenteditable]{
  background:#f9fafb;
  border-radius:4px;
  padding:5px;
}
</style>
</head>
<body>
<div class="container">
<h1>ðŸ“‹ Meine Bewerbungen</h1>

<form id="companyForm">
  <input type="text" id="name" placeholder="Firmenname" required>
  <input type="text" id="city" placeholder="Stadt">
  <input type="email" id="email" placeholder="E-Mail">
  <input type="text" id="phone" placeholder="Telefon">
  <textarea id="notes" placeholder="Notizen"></textarea>
  <button type="submit" class="add-btn">Firma hinzufÃ¼gen</button>
</form>

<div class="filters">
  <input type="text" id="searchInput" placeholder="ðŸ”Ž Firma suchen...">
  <select id="cityFilter">
    <option value="">Alle StÃ¤dte</option>
  </select>
  <select id="statusFilter">
    <option value="">Alle Status</option>
    <option value="Gesendet">Gesendet</option>
    <option value="Antwort">Antwort</option>
    <option value="Einladung">Einladung</option>
    <option value="Absage">Absage</option>
  </select>
</div>

<div class="counter" id="counter"></div>

<table>
  <thead>
    <tr>
      <th>#</th>
      <th>Firma</th>
      <th>Stadt</th>
      <th>E-Mail</th>
      <th>Telefon</th>
      <th>Status</th>
      <th>Notizen</th>
      <th>Datum</th>
      <th>Aktion</th>
    </tr>
  </thead>
  <tbody id="companyList"></tbody>
</table>
</div>

<script>
const statusOrder=["Gesendet","Antwort","Einladung","Absage"];

document.addEventListener("DOMContentLoaded", ()=>{
  loadCompanies();
  loadCityFilter();
});

document.getElementById("companyForm").addEventListener("submit", function(e){
  e.preventDefault();

  let name = document.getElementById("name").value.trim();

  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙƒØ±Ø§Ø± Ø§Ù„Ø§Ø³Ù…
  let companies = JSON.parse(localStorage.getItem("companies")) || [];
  if(companies.some(c => c.name.toLowerCase() === name.toLowerCase())){
    alert("Diese Firma wurde bereits eingetragen!");
    return;
  }

  // ØªØ­ÙˆÙŠÙ„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ù„ØµÙŠØºØ© +49
  let phone = document.getElementById("phone").value.trim();
  if(phone.startsWith("0")){
    phone = "+49" + phone.slice(1);
  } else if(!phone.startsWith("+49")){
    phone = "+49" + phone;
  }

  const today = new Date().toLocaleDateString();

  const company = {
    name: name,
    city: document.getElementById("city").value.trim(),
    email: document.getElementById("email").value.trim(),
    phone: phone,
    status: "Gesendet",
    notes: document.getElementById("notes").value.trim(),
    date: today
  };

  companies.push(company);
  localStorage.setItem("companies", JSON.stringify(companies));

  this.reset();
  loadCompanies();
  loadCityFilter();
});

["searchInput","cityFilter","statusFilter"].forEach(id=>{
  document.getElementById(id).addEventListener("input", loadCompanies);
});

function loadCompanies(){
  const searchText = document.getElementById("searchInput").value.toLowerCase();
  const cityText = document.getElementById("cityFilter").value.toLowerCase();
  const statusText = document.getElementById("statusFilter").value;
  const list = document.getElementById("companyList");
  const counter = document.getElementById("counter");
  list.innerHTML="";
  let companies = JSON.parse(localStorage.getItem("companies")) || [];
  let count=0;
  companies.forEach((company,index)=>{
    if(
      !company.name.toLowerCase().includes(searchText) ||
      (cityText && company.city.toLowerCase() !== cityText) ||
      (statusText && company.status !== statusText)
    ) return;

    count++;
    list.innerHTML+=`
      <tr>
        <td>${count}</td>
        <td>${company.name}</td>
        <td>${company.city}</td>
        <td>${company.email}</td>
        <td>${company.phone}</td>
        <td>
          <button class="status-btn ${company.status}" onclick="changeStatus(${index})">
            ${company.status}
          </button>
        </td>
        <td contenteditable="true" onblur="updateNotes(${index}, this.innerText)">${company.notes}</td>
        <td>${company.date}</td>
        <td>
          <button class="delete-btn" onclick="deleteCompany(${index})">LÃ¶schen</button>
        </td>
      </tr>`;
  });
  counter.innerText = "Gefundene Bewerbungen: "+count;
}

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
function updateNotes(index, value){
  let companies = JSON.parse(localStorage.getItem("companies")) || [];
  companies[index].notes = value.trim();
  localStorage.setItem("companies", JSON.stringify(companies));
}

// ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø©
function changeStatus(index){
  let companies = JSON.parse(localStorage.getItem("companies")) || [];
  let nextIndex = (statusOrder.indexOf(companies[index].status)+1)%statusOrder.length;
  companies[index].status = statusOrder[nextIndex];
  localStorage.setItem("companies",JSON.stringify(companies));
  loadCompanies();
}

// Ø­Ø°Ù Ø§Ù„Ø´Ø±ÙƒØ©
function deleteCompany(index){
  let companies = JSON.parse(localStorage.getItem("companies")) || [];
  companies.splice(index,1);
  localStorage.setItem("companies",JSON.stringify(companies));
  loadCompanies();
  loadCityFilter();
}

// ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¯Ù† ÙÙŠ Ø§Ù„ÙÙ„ØªØ± ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
function loadCityFilter(){
  let companies = JSON.parse(localStorage.getItem("companies")) || [];
  let cityFilter = document.getElementById("cityFilter");
  let selected = cityFilter.value;
  let cities = Array.from(new Set(companies.map(c=>c.city).filter(c=>c))).sort();
  cityFilter.innerHTML='<option value="">Alle StÃ¤dte</option>';
  cities.forEach(city=>{
    cityFilter.innerHTML+=`<option value="${city}">${city}</option>`;
  });
  if(selected) cityFilter.value = selected;
}
</script>
</body>
</html>
